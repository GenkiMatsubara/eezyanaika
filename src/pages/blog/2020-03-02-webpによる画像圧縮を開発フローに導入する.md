---
image: /img/og-image.jpg
templateKey: blog-post
title: WebPによる画像圧縮を開発フローに導入する
date: 2020-03-02T07:21:59.747Z
description: |-
  画像の圧縮効率のいいWebPを開発フローに導入するまでのお話です。
  簡単に書いた導入コードを踏まえて実際の画像の軽量化について紹介しています。
featuredpost: false
featuredimage: /img/og-image.jpg
tags:
  - tech
---
## WebPとは？



Googleが開発している画像フォーマット。
jpgやpngに比べ20%ほど容量を圧縮することができる。

[wikipedia-WebP](https://ja.wikipedia.org/wiki/WebP)



### メリット

* 圧縮効率がいいのでimageminで圧縮した画像よりも容量を節約できる
* Google製なのでPageSpeed Insightsよく指摘される『次世代の画像配信』がこれにあたるのでスコアが改善できる。



### デメリット

* WebPは静止画なのでGifに対応する場合は別途設定が必要になる



## 1.MacにWebPを導入していく

設定しないとMacで画像のプレビューが表示されない

https://webrandum.net/quick-look-plugins/



### MacにWebPを導入していく

ターミナルで下記の順でコマンドを実行する。

1. `ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)" < /dev/null 2> /dev/null ; brew install caskroom/cask/brew-cask 2> /dev/null`
2. `brew cask install webpquicklook`

``

## 2.gulpで実行できるようにする



gulp-webpをインストールする
`npm i gulp-webp`

https://www.npmjs.com/package/gulp-webp

```
// gulpfile.js
const gulp = require('gulp');
const webp = require('gulp-webp');
// ディレクトリはお好きに
const distDir = 'dist';
const srcDir = 'src';


// webp形式での変換
gulp.task('webp', () =>
  gulp.src(srcDir + '/*.{png,jpg,PNG,JPG}')
    .pipe(webp())
    .pipe(gulp.dest(distDir))
);
```

実行する


`gulp webp`



上記のコマンドをビルドする前に自動で実行するようにすれば変換忘れを防げる。
この辺の処理はpngの圧縮などと同じで自動化したい。



## 実行結果



画像の容量を大きく削減することができました！
容量を半分以下に抑えることができます。



### WebP変換前

jpg 1.9 MB

png 37.3 kB



## WebP変換後

上記の元データがjpg画像
**782.5 kB**

上記の元データがpng画像
**7.7 kB**



### 注意点・改善点

```
└── src
    ├── test.jpg
    └── test.png
```

画像の拡張子が変わるのでjpg、pngで同じ名前の画像がある場合で同じディレクトリに出力する場合は
どちらか一方のみが出力されるので変換漏れに気づかなかったりしそう。



## まとめ

画像のWebP変換の導入はかなり簡単。
SVGとの使い分け、jpg、pngとの違いを踏まえた上でWebPを使っていきたい。
